<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculate scores for PHAB • PHAB</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Calculate scores for PHAB">
<meta property="og:description" content="Calculate scores for the Physical Habitat (PHAB) index.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">PHAB</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.1.9006</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<div id="phab" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#phab" class="anchor"></a>PHAB</h1></div>
<div id="marcus-w--beck-marcusbsccwrp-org-raphael-d--mazor-raphaelmsccwrp-org-andrew-c--rehn-andy-rehnwildlife-ca-gov" class="section level4">
<h4 class="hasAnchor">
<a href="#marcus-w--beck-marcusbsccwrp-org-raphael-d--mazor-raphaelmsccwrp-org-andrew-c--rehn-andy-rehnwildlife-ca-gov" class="anchor"></a><em>Marcus W. Beck, <a href="mailto:marcusb@sccwrp.org">marcusb@sccwrp.org</a>, Raphael D. Mazor, <a href="mailto:raphaelm@sccwrp.org">raphaelm@sccwrp.org</a>, Andrew C. Rehn, <a href="mailto:andy.rehn@wildlife.ca.gov">andy.rehn@wildlife.ca.gov</a></em>
</h4>

<p>The PHAB package contains materials to calculate an index of physical integrity (IPI) for California streams. This index is estimated using site-specific data and available metrics of physical habitat to describe overall integrity.</p>
<p>This tutorial assumes that the user is familiar with basic operations in the R programming language, such as data import, export, and manipulation. Although not required, we recommend using an integrated development environment for R, such as R-studio, which can be downloaded at <a href="http://www.rstudio.com" class="uri">http://www.rstudio.com</a>. New users are encouraged to pursue training opportunities, such as those hosted by local R user groups. A list of such groups may be found here: <a href="http://blog.revolutionanalytics.com/local-r-groups.html" class="uri">http://blog.revolutionanalytics.com/local-r-groups.html</a>. R training material developed by SCCWRP can also be found online: <a href="https://sccwrp.github.io/SCCWRP_R_training/" class="uri">https://sccwrp.github.io/SCCWRP_R_training/</a></p>
</div>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>Install the package as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">'devtools'</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(devtools)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">install_github</span>(<span class="st">'SCCWRP/PHAB'</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(PHAB)</a></code></pre></div>
</div>
<div id="basic-usage" class="section level1">
<h1 class="hasAnchor">
<a href="#basic-usage" class="anchor"></a>Basic usage</h1>
<p>The core function is <code>IPI</code> that requires station and phab data as input.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="reference/IPI.html">IPI</a></span>(stations, phab)</a></code></pre></div>
<pre><code>##   StationCode SampleDate       PHAB_SampleID  IPI IPI_percentile
## 1   105PS0107  9/14/2009 105PS0107_9/14/2009 1.16           0.90
## 2   205PS0157  6/19/2012 205PS0157_6/19/2012 1.04           0.62
## 3   305PS0057  6/16/2009 305PS0057_6/16/2009 0.79           0.04
## 4   504PS0147  6/23/2008 504PS0147_6/23/2008 0.78           0.03
## 5   632PS0007  7/23/2008 632PS0007_7/23/2008 1.10           0.79
## 6   901PS0057  5/14/2008 901PS0057_5/14/2008 1.08           0.74
##   Ev_FlowHab Ev_FlowHab_score H_AqHab H_AqHab_pred H_AqHab_score H_SubNat
## 1       0.85             0.89    1.59         1.11          1.00     1.57
## 2       0.96             1.00    1.42         1.35          0.80     1.41
## 3       0.50             0.51    1.32         1.42          0.70     0.49
## 4       0.28             0.28    1.24         1.30          0.72     0.98
## 5       0.90             0.95    1.51         1.41          0.82     1.80
## 6       0.70             0.73    1.52         1.38          0.84     1.80
##   H_SubNat_score PCT_SAFN PCT_RC PCT_SAFN_pred PCT_SAFN_score XCMG
## 1           0.83        6      0         24.60           1.00   99
## 2           0.74       51      2         22.06           0.40  131
## 3           0.26       83      0         29.51           0.12  152
## 4           0.52        1      0         34.38           1.00   55
## 5           0.95       14      0         13.49           0.79  126
## 6           0.95       40      3         34.46           0.69  122
##   XCMG_pred XCMG_score IPI_qa Ev_FlowHab_qa H_AqHab_qa H_SubNat_qa
## 1     93.64       0.78   1.00             1          1           1
## 2    104.72       0.90   1.00             1          1           1
## 3    106.05       1.00   1.00             1          1           1
## 4     95.41       0.51   1.00             1          1           1
## 5    123.10       0.76   1.00             1          1           1
## 6    102.16       0.86   0.95             1          1           1
##   PCT_SAFN_qa XCMG_qa
## 1           1    1.00
## 2           1    1.00
## 3           1    1.00
## 4           1    1.00
## 5           1    1.00
## 6           1    0.95</code></pre>
</div>
<div id="detailed-usage" class="section level1">
<h1 class="hasAnchor">
<a href="#detailed-usage" class="anchor"></a>Detailed usage</h1>
<p>The PHAB package can be installed from the R console with just a few lines of code. The current version of the package can be found on SCCWRP’s GitHub page <a href="https://github.com/SCCWRP/PHAB">here</a> and can be installed using the devtools package. The devtools package must be installed first before the PHAB package can be installed. Start by installing and loading devtools:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">'devtools'</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">library</span>(devtools)</a></code></pre></div>
<p>Now the <code>install_github()</code> function from devtools can be used to install PHAB from GitHub. The package can be loaded after installation.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">install_github</span>(<span class="st">'SCCWRP/PHAB'</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">library</span>(PHAB)</a></code></pre></div>
<p>The installation process may take a few seconds. Both the devtools and PHAB packages depend on other R packages, all of which are installed together. If an error is encountered during installation, an informative message is usually printed in the R console. This information can help troubleshoot the problem, such as identifying which dependent packages may need to be installed separately. Please contact SCCWRP staff if additional errors are encountered.</p>
<p>After the package is successfully installed, you will be able to view the help file for the PHAB core function:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">?IPI</a></code></pre></div>
<div id="preparing-input-data" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-input-data" class="anchor"></a>Preparing input data</h2>
<p>The IPI is estimated using station and PHAB metric data as input. Station GIS data can be obtained using the GIS insructions that accompany this document and PHAB metric data can be obtained from the state of California SWAMP reporting module. Sample data are provided with the PHAB package to demonstrate the required format and are loaded automatically once the package is installed and loaded (i.e., just type the name of the sample data in the R console to view). You can view the <code>stations</code> and <code>phab</code> example data from the R console:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">head</span>(stations)</a></code></pre></div>
<pre><code>##   StationCode MAX_ELEV  AREA_SQKM ELEV_RANGE MEANP_WS  New_Long SITE_ELEV
## 1   105PS0107     2587 2002.90397    2050.96 882.4179 -123.0173    536.04
## 2   205PS0157     1111  600.95071    1074.00 604.9312 -121.8352     37.00
## 3   305PS0057     1152 1261.70747    1107.36 544.3272 -121.5114     44.64
## 4   504PS0147     2144 1954.62572    2059.52 781.2332 -122.2178     84.48
## 5   632PS0007     3348   98.66497    1240.06 962.0929 -119.5937   2107.94
## 6   901PS0057     1734   92.31964    1671.43 495.7878 -117.6696     62.57
##    KFCT_AVE  New_Lat MINP_WS PPT_00_09
## 1 0.1776000 41.71375 10.9294   54996.9
## 2 0.2927333 37.30141  0.7059   40023.9
## 3 0.2840000 36.95052  0.6623   42432.2
## 4 0.2181000 39.77572  2.7024   53740.0
## 5 0.1217000 38.53335 17.9569   67846.9
## 6 0.2854000 33.52814  0.5268   29440.0</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">head</span>(phab)</a></code></pre></div>
<pre><code>##   StationCode SampleDate      Variable Result Count_Calc
## 1   105PS0107  9/14/2009  W1_HALL_EMAP   0.00         11
## 2   105PS0107  9/14/2009 W1_HALL_SWAMP   0.00         14
## 3   105PS0107  9/14/2009      PCT_CPOM  24.00        105
## 4   105PS0107  9/14/2009      Ev_AqHab   0.77          8
## 5   105PS0107  9/14/2009    Ev_FlowHab   0.85          4
## 6   105PS0107  9/14/2009     Ev_SubNat   0.75          8</code></pre>
<p>The <code>stations</code> data include site-specific information derived from geospatial analysis. These data are in wide format where one row corresponds to data for one site. The following fields are required:</p>
<ul>
<li>
<code>StationCode</code> unique station identifier</li>
<li>
<code>MAX_ELEV</code> maximum elevation in the watershed in meters</li>
<li>
<code>AREA_SQKM</code> watershed area in square kilometers</li>
<li>
<code>ELEV_RANGE</code> elevation range of the watershed in meters</li>
<li>
<code>MEANP_WS</code> mean phosphorus geology from the watershed</li>
<li>
<code>New_Long</code> site longitude, decimal degrees</li>
<li>
<code>SITE_ELEV</code> site elevation</li>
<li>
<code>KFCT_AVE</code> average soil erodibility factor</li>
<li>
<code>New_Lat</code> site latitude, decimal degrees</li>
<li>
<code>MINP_WS</code> minimum phosphorus geology from the watershed</li>
<li>
<code>PPT_00_09</code> average precipitation (2000 to 2009) at the sample point, in hundredths of millimeters</li>
</ul>
<p>The <code>phab</code> data include calculated physical habitat metrics that are compiled along with the <code>stations</code> data to get the IPI score. These data are in long format where multiple rows correspond to physical habitat metric values for a single site. The following fields are required:</p>
<ul>
<li>
<code>StationCode</code> unique station identifier</li>
<li>
<code>SampleDate</code> date of the sample</li>
<li>
<code>Variable</code> name of the PHAB metric</li>
<li>
<code>Result</code> resulting metric value</li>
<li>
<code>Count_Calc</code> number of unique observations that were used to estimate the value in <code>Result</code>
</li>
</ul>
<p>Values in the <code>Variable</code> column of the <code>phab</code> data indicate which PHAB metric was measured that corresponds to values in the <code>Result</code> column. The required PHAB metrics that should be provided for every unique sampling event specified by <code>StationCode</code> and <code>SampleDate</code> are as follows:</p>
<ul>
<li>
<code>XSLOPE</code> mean slope of reach</li>
<li>
<code>XBKF_W</code> mean bankfull width</li>
<li>
<code>H_AqHab</code> Shannon diversity of aquatic habitat types</li>
<li>
<code>PCT_SAFN</code> percent sand and fine (&lt;2 mm) substrate particles</li>
<li>
<code>XCMG</code> riparian cover sum of three layers</li>
<li>
<code>Ev_FlowHab</code> evenness of flow habitat types</li>
<li>
<code>H_SubNat</code> Shannon diversity of natural substrate types</li>
<li>
<code>XC</code> mean upper canopy trees and saplings</li>
<li>
<code>PCT_POOL</code> percent pools in reach</li>
<li>
<code>XFC_ALG</code> mean filamentous algae cover</li>
<li>
<code>PCT_RC</code> percent concrete/asphalt</li>
</ul>
<p>Each PHAB metric serves a specific purpose in the calculation and reporting of the IPI. Some metrics (i.e., <code>H_AqHab</code>, <code>PCT_SAFN</code>, <code>XCMG</code>, <code>Ev_FlowHab</code>, and <code>H_SubNat</code>) are used to assess habitat condition. Other metrics (i.e., <code>XSLOPE</code>, <code>XBKF_W</code>, and <code>PCT_RC</code>) are used as predictors or score modifiers for components of the IPI. Finally, some metrics (i.e., the <code>XC</code>, <code>PCT_POOL</code>, and <code>XFC_ALG</code>) are required because they are used for quality assurance checks.</p>
<p>All required fields for the <code>stations</code> and <code>phab</code> data are case-sensitive and must be spelled correctly. The order of the fields does not matter. All <code>StationCode</code> values must be shared between the datasets. As described below, the <code><a href="reference/IPI.html">IPI()</a></code> function automatically checks the format of the input data prior to estimating scores.</p>
</div>
<div id="detailed-metric-descriptions" class="section level2">
<h2 class="hasAnchor">
<a href="#detailed-metric-descriptions" class="anchor"></a>Detailed metric descriptions</h2>
<p>Five of the required PHAB metrics in the input data are used directly for scoring the IPI, whereas the remainder serve a supporting role as predictors or modifiers for different parts of the complete index. Understanding what each of five core metrics describe about stream condition and how they vary with disturbance is critical for interpreting the index. Below is a detailed description of each metric (excerpted from the <a href="https://www.waterboards.ca.gov/water_issues/programs/swamp/bioassessment/docs/physical_habitat_index_technical_memo.pdf">tech memo</a>, click for more detail).</p>
<p><em>Shannon diversity of natural instream cover</em>. <code>H_AqHab</code> measures the relative quantity and variety of natural structures in the stream, such as cobble, large and small boulders, fallen trees, logs and branches, and undercut banks available as refugia, or as sites for feeding or spawning and nursery functions of aquatic macrofauna. A wide variety and/or abundance of submerged structures in the stream provides macroinvertebrates and fish with a large number of niches, thus increasing habitat diversity. When variety and abundance of cover decreases (e.g., due to hydromodification, increased sedimentation, or active stream clearing), habitat structure becomes monotonous, diversity decreases, and the potential for recovery following disturbance decreases. Snags and submerged logs—especially old logs that have remained in-place for several years–are among the most productive habitat structure for macroinvertebrate colonization and fish refugia in low-gradient streams.</p>
<p><em>Percent sand and fine substrate</em>. <code>PCT_SAFN</code> measures the amount of small-grained sediment particles (i.e., &lt;2 mm) that have accumulated in the stream bottom as a result of deposition. Deposition may result from soil disturbance in the catchment, landslides, and bank erosion. Sediment deposition may cause the formation of islands or point bars, filling of runs and pools, and embeddedness of gravel, cobble, and boulders and snags, with larger substrate particles covered or sunken into the silt, sand, or mud of the stream bottom. As habitat provided by cobbles or woody debris becomes embedded, and as interstitial spaces become inundated by sand or silt, the surface area available to macroinvertebrates and fish is decreased. High levels of sediment deposition are symptoms of an unstable and continually changing environment that becomes unsuitable for many organisms. Although human activity may deplete sands and fines (e.g., by upstream dam operations), and this depletion may harm aquatic life, the IPI treats only increases in this metric as a negative impact on habitat quality, although a <em>post-hoc</em> correction was made whereby the metric percent concrete (<code>PCT_RC</code>) is added to <code>PCT_SAFN</code> before scoring.</p>
<p><em>Shannon diversity of natural substrate types</em>. <code>H_SubNat</code> measures the diversity of natural substrate types, assessing how well multiple size classes (e.g., gravel, cobble and boulder particles) are represented. In a stream with high habitat quality for benthic macroinvertebrates, layers of cobble and gravel provide diversity of niche space. Occasional patches of fine sediment, root mats and bedrock also provide important habitat for burrowers or clingers, but do not dominate the streambed. Lack of substrate diversity, e.g., where &gt;75% of the channel bottom is dominated by one particle size or hard-pan, or with highly compacted particles with no interstitial space, represents poor physical conditions. Riffles and runs with a diversity of particle sizes often provide the most stable habitat in many small, high-gradient streams.</p>
<p><em>Evenness of flow habitat types</em>. <code>Ev_FlowHab</code> measures the evenness of riffles, pools, and other flow microhabitat types. Optimal physical conditions include a relatively even mix of velocity/depth regimes, with regular alternation between riffles (fast-shallow), runs (fast-deep), glides (slow-shallow) and pools (slow-deep). Poor conditions occur when a single microhabitat dominates (usually glides, with pools and riffles absent). A stream that has a uniform flow regime will typically support far fewer types of organisms than a stream that has a variety of alternating flow regimes. Riffles in particular are a source of high-quality habitat and diverse fauna, and their regular occurrence along the length of a stream greatly enhances the diversity of the stream community. Pools are essential for many fish and amphibians.</p>
<p><em>Riparian vegetation cover, sum of three layers</em>. <code>XCMG</code> measures the amount of vegetative protection afforded to the stream bank and the near-stream portion of the riparian zone. The root systems of plants growing on stream banks help hold soil in place, thereby reducing the amount of erosion likely to occur. The vegetative zone also serves as a buffer to pollutants entering a stream from runoff and provides shading and habitat and nutrient input into the stream. Banks that have full, multi-layered, natural plant growth are better for fish and macroinvertebrates than are banks without vegetative protection or those shored up with concrete or riprap. Vegetative removal and reduced riparian zones occur when roads, parking lots, fields, lawns, bare soil, riprap, or buildings are near the stream bank. Residential developments, urban centers, golf courses, and high grazing pressure from livestock are the common causes of anthropogenic degradation of the riparian zone. Even in undeveloped areas, upstream hydromodification and invasion by non-native species can reduce the cover and quality of riparian zone vegetation.</p>
</div>
<div id="using-the-ipi-function" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-ipi-function" class="anchor"></a>Using the <code><a href="reference/IPI.html">IPI()</a></code> function</h2>
<p>The IPI score for a site is estimated from the station and PHAB data. The score is estimated automatically by the <code><a href="reference/IPI.html">IPI()</a></code> function in the package following several steps. First, reference expectations for a site are estimated for predictive metrics using the station data. Then, observed data values are compared to reference expectations for predictive metrics and the differences between observed and predicted (i.e., metric residuals) are used for scoring. For metrics that are not predicted, raw metric values are used for scoring. Metric scores are based on the upper and lower percentiles of either metric residuals or raw metric values observed at reference and high-activity sites. The metric scores are then summed and standardized (i.e., divided) by the mean sum of scores at reference sites to obtain the final IPI score.</p>
<p>The <code><a href="reference/IPI.html">IPI()</a></code> function can be used on station and PHAB data that are correctly formatted as shown above. The <code>stations</code> and <code>phab</code> example data are in the correct format and are loaded automatically with the PHAB package. These data are used here to demonstrate use of the <code><a href="reference/IPI.html">IPI()</a></code> function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="reference/IPI.html">IPI</a></span>(stations, phab)</a></code></pre></div>
<pre><code>##   StationCode SampleDate       PHAB_SampleID  IPI IPI_percentile
## 1   105PS0107  9/14/2009 105PS0107_9/14/2009 1.16           0.90
## 2   205PS0157  6/19/2012 205PS0157_6/19/2012 1.04           0.62
## 3   305PS0057  6/16/2009 305PS0057_6/16/2009 0.79           0.04
## 4   504PS0147  6/23/2008 504PS0147_6/23/2008 0.78           0.03
## 5   632PS0007  7/23/2008 632PS0007_7/23/2008 1.10           0.79
## 6   901PS0057  5/14/2008 901PS0057_5/14/2008 1.08           0.74
##   Ev_FlowHab Ev_FlowHab_score H_AqHab H_AqHab_pred H_AqHab_score H_SubNat
## 1       0.85             0.89    1.59         1.11          1.00     1.57
## 2       0.96             1.00    1.42         1.35          0.80     1.41
## 3       0.50             0.51    1.32         1.42          0.70     0.49
## 4       0.28             0.28    1.24         1.30          0.72     0.98
## 5       0.90             0.95    1.51         1.41          0.82     1.80
## 6       0.70             0.73    1.52         1.38          0.84     1.80
##   H_SubNat_score PCT_SAFN PCT_RC PCT_SAFN_pred PCT_SAFN_score XCMG
## 1           0.83        6      0         24.60           1.00   99
## 2           0.74       51      2         22.06           0.40  131
## 3           0.26       83      0         29.51           0.12  152
## 4           0.52        1      0         34.38           1.00   55
## 5           0.95       14      0         13.49           0.79  126
## 6           0.95       40      3         34.46           0.69  122
##   XCMG_pred XCMG_score IPI_qa Ev_FlowHab_qa H_AqHab_qa H_SubNat_qa
## 1     93.64       0.78   1.00             1          1           1
## 2    104.72       0.90   1.00             1          1           1
## 3    106.05       1.00   1.00             1          1           1
## 4     95.41       0.51   1.00             1          1           1
## 5    123.10       0.76   1.00             1          1           1
## 6    102.16       0.86   0.95             1          1           1
##   PCT_SAFN_qa XCMG_qa
## 1           1    1.00
## 2           1    1.00
## 3           1    1.00
## 4           1    1.00
## 5           1    1.00
## 6           1    0.95</code></pre>
<p>A data frame of IPI scores estimated at each site on each unique sample date is returned. The output data are in wide format with one row for each sample date at a site. Detailed information for each output column is as follows:</p>
<ul>
<li>
<code>StationCode</code> unique station identifier</li>
<li>
<code>SampleDate</code> date of the site visit</li>
<li>
<code>PHAB_SampleID</code> unique identifier of the sampling event. Typically, the station code and sample data are sufficient to determine unique sampling events.</li>
<li>
<code>IPI</code> score for the index of physical integrity</li>
<li>
<code>IPI_percentile</code> the percentile of the IPI score relative to scores at reference sites</li>
<li>
<code>Ev_FlowHab</code> evenness of flow habitat types, from the raw PHAB metric</li>
<li>
<code>Ev_FlowHab_score</code> IPI score for evenness of flow habitat types</li>
<li>
<code>H_AqHab</code> Shannon diversity of natural instream cover types, from the raw PHAB metric</li>
<li>
<code>H_AqHab_pred</code> predicted Shannon diversity of natural instream cover types</li>
<li>
<code>H_AqHab_score</code> scored Shannon diversity of natural instream cover types</li>
<li>
<code>H_SubNat</code> Shannon Diversity of natural substrate types, from the raw PHAB metric</li>
<li>
<code>H_SubNat_score</code> scored Shannon diversity of natural substrate types</li>
<li>
<code>PCT_SAFN</code> percent sand and fine substrate, from the raw PHAB metric</li>
<li>
<code>PCT_RC</code> percent concrete/asphalt, from the raw PHAB metric and is combined with <code>PCT_SAFN</code> to provide an overall estimate of substrate with poor suitability for macrofauna</li>
<li>
<code>PCT_SAFN_pred</code> predicted percent sand and fine substrate</li>
<li>
<code>PCT_SAFN_score</code> scored percent sand and fine substrate, includes <code>PCT_RC</code>
</li>
<li>
<code>XCMG</code> riparian cover as sum of three layers, from the raw PHAB metric</li>
<li>
<code>XCMG_pred</code> predicted riparian cover as sum of three layers</li>
<li>
<code>XCMG_score</code> scored riparian cover as sum of three layers</li>
<li>
<code>IPI_qa</code> quality assurance for the IPI score</li>
<li>
<code>Ev_FlowHab_qa</code> quality assurance for evenness of flow habitat types</li>
<li>
<code>H_AqHab_qa</code> quality assurance for Shannon diversity of aquatic habitat types</li>
<li>
<code>H_SubNat_qa</code> quality assurance for Shannon diversity of natural substrate types</li>
<li>
<code>PCT_SAFN_qa</code> quality assurance for percent sand and fine substrate</li>
<li>
<code>XCMG_qa</code> quality assurance for riparian cover as sum of three layers</li>
</ul>
<p>Metrics are included in the output as observed PHAB metrics, predicted metrics (where applicable), and scored metrics. Observed PHAB metrics are returned as-is from the input data. Some PHAB metrics include a predicted column that shows the modelled metric value based on the environmental setting at a site. Scored PHAB metrics are obtained following the description above.</p>
<p>The last five columns include quality assurance information for the IPI score and select metrics. QA values less than one indicate less quality assurance, usually resulting from metric values being calculated from fewer measurements from a sample than specified by field protocols. <code>IPI_qa</code> (the overall QA value for the IPI) is based on the lowest score among all metrics. At this time, there is no criterion for flagging an IPI score based on QA measurements; analysts are advised to use their personal judgment when evaluating IPI scores with low QA measurements.</p>
</div>
<div id="interpreting-ipi-scores" class="section level2">
<h2 class="hasAnchor">
<a href="#interpreting-ipi-scores" class="anchor"></a>Interpreting IPI scores</h2>
<p>The IPI was calibrated during its development so that the mean score of reference sites is 1; IPI scores near 1 represent locations with conditions similar to reference sites. Scores that approach 0 indicate great departure from reference condition and degradation of physical condition. Scores &gt; 1 can be interpreted to indicate greater physical complexity than predicted for a site given its natural environmental setting. All metric scores are weighted equally to determine the overall IPI score. For observed and scored PHAB metrics, all are expected to decrease under degraded physical conditions, except PCT_SAFN which is expected to increase in response to degradation.</p>
</div>
<div id="calibration-data" class="section level2">
<h2 class="hasAnchor">
<a href="#calibration-data" class="anchor"></a>Calibration data</h2>
<p>An additional data file is available within the PHAB package that shows calibration data for scoring the IPI metrics. This file is called <code>refcal</code> and includes observed and predicted scores at reference and high-activity (or “stressed”) sites for the five PHAB metrics. Metrics are scored based on deviation from the 5th and 95th percentile of scores at reference or calibration sites. The <code>refcal</code> dataset includes observations at these sites that were used to identify percentile cutoffs for estimating metric scores (the dataset is loaded automatically with the PHAB package, just type the name in the console to view).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">head</span>(refcal)</a></code></pre></div>
<pre><code>##     Variable StationCode      SampleID2   SiteSet Result Predicted
## 1 Ev_FlowHab   000CAT228 000CAT22840400    RefCal   0.77 0.6498149
## 2 Ev_FlowHab   101WE1111 101WE111137474 StressCal   0.94 0.6535123
## 3 Ev_FlowHab   103CDCHHR 103CDCHHR40435    RefCal   0.63 0.7295132
## 4 Ev_FlowHab   103WER026 103WER02637831    RefCal   0.75 0.6590854
## 5 Ev_FlowHab   103WER029 103WER02937832    RefCal   0.94 0.7125525
## 6 Ev_FlowHab   105BVCAGC 105BVCAGC40442    RefCal   0.84 0.6973526</code></pre>
<ul>
<li>
<code>Variable</code> name of the PHAB metric</li>
<li>
<code>StationCode</code> unique station identifier</li>
<li>
<code>SampleID2</code> unique identifier of the sampling event</li>
<li>
<code>SiteSet</code> indicating if a site was reference or stressed</li>
<li>
<code>Result</code> resulting metric value</li>
<li>
<code>Predicted</code> predicted metric value</li>
</ul>
</div>
<div id="error-checks-for-input-data" class="section level2">
<h2 class="hasAnchor">
<a href="#error-checks-for-input-data" class="anchor"></a>Error checks for input data</h2>
<p>The <code><a href="reference/IPI.html">IPI()</a></code> function will evaluate both the <code>stations</code> and <code>phab</code> input datasets for correct format before estimating IPI scores. IPI scores will not be calculated if any errors are encountered. The following checks are made:</p>
<ul>
<li>No duplicate station codes in <code>stations</code>. That is, input data have one row per station.</li>
<li>All station codes in <code>stations</code> are in <code>phab</code>, and vice-versa</li>
<li>All required fields are present in <code>stations</code> and <code>phab</code> (see above)</li>
<li>All required PHAB metrics are present in the <code>variable</code> field of <code>phab</code> for each station and sample date (see above). An exception is made for <code>XC</code>, <code>PCT_POOL</code>, and <code>XFC_ALG</code>, which are not necessary for calculating the IPI but are used for optional quality assurance checks.</li>
<li>No duplicate results for PHAB variables at each station and sample date. That is, one row per station, date, and phab metric.</li>
<li>All input variables for <code>stations</code> and <code>phab</code> are non-negative, excluding elevation variables in <code>stations</code> which may be negative if below sea level (i.e., some locations in southeast California). Moreover, the variables <code>XBKF_W</code> and <code>Ev_FlowHab</code> in <code>phab</code> must also be greater than zero.</li>
</ul>
<p>The <code><a href="reference/IPI.html">IPI()</a></code> function will print informative messages to the R console if any of these errors are encountered. It is the responsibility of the analyst to correct any errors in the raw data before proceeding.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Report a bug at <br><a href="https://github.com/SCCWRP/PHAB/issues">https://​github.com/​SCCWRP/​PHAB/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>CC0</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Marcus W. Beck <br><small class="roles"> Author, maintainer </small>  </li>
<li>Raphael D. Mazor <br><small class="roles"> Author </small>  </li>
<li>Andrew C. Rehn <br><small class="roles"> Author </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://ci.appveyor.com/project/SCCWRP/PHAB"><img src="https://ci.appveyor.com/api/projects/status/github/SCCWRP/PHAB?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a></li>
<li><a href="https://travis-ci.org/SCCWRP/PHAB"><img src="https://travis-ci.org/SCCWRP/PHAB.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://zenodo.org/badge/latestdoi/108920024"><img src="https://zenodo.org/badge/108920024.svg" alt="DOI"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Marcus W. Beck, Raphael D. Mazor, Andrew C. Rehn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
