---
output:
  html_document:
    keep_md: yes
    toc: no
    self_contained: no
---
## PHAB

#### *Marcus W. Beck, marcusb@sccwrp.org, Raphael Mazor, raphaelm@sccwrp.org*

[![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/SCCWRP/PHAB?branch=master&svg=true)](https://ci.appveyor.com/project/SCCWRP/PHAB)
[![Travis-CI Build Status](https://travis-ci.org/SCCWRP/PHAB.svg?branch=master)](https://travis-ci.org/SCCWRP/PHAB)
[![DOI](https://zenodo.org/badge/108920024.svg)](https://zenodo.org/badge/latestdoi/108920024)

This package contains materials to calculate scores of physical habitat integrity, or PHAB, for California streams. 

### Installation

Install the package as follows:

```{r, eval = FALSE}
install.packages('devtools')
library(devtools)
install_github('SCCWRP/PHAB')
library(PHAB)
```

### Usage

The core function is `IPI` that requires station and phab data as input.

```{r, echo = F, message = F, warning = F}
devtools::load_all()
```
```{r}
IPI(stations, phab)
```

Error checks are used to verify correct formatting of the input data.  The following checks are made:

* No duplicate station codes in `stations`
* All station codes in `stations` are in `phab` and the converse
* All required fields in `stations` and `phab`
* All required PHAB variables are present in the `variable` field of `phab` for each station and sample date
* No duplicate results for PHAB variables at each station and sample date
* All input variables for `stations` and `phab` are non-negative. The variables `XBKF_W`, `H_Aq_Hab`, `Ev_FlowHab`, and `H_SubNat` in `phab` must also be greater than zero.

The `chkinp` function can be used independently to check formatting of the input data.  The function will return an error if the data are formatted incorrectly. 
```{r, error = T}
stations$StationCode[1] <- stations$StationCode[2]
chkinp(stations, phab)
data(stations)
phab <- subset(phab, !phab$Variable %in% 'XSLOPE')
chkinp(stations, phab)
```

